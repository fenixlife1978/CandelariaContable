/**
 * This ruleset implements a model where any authenticated user has full
 * read and write access to the data.
 *
 * Core Philosophy:
 * The security model grants universal read and write access to any user who
 * is authenticated. Unauthenticated access is fully denied, except for
 * reading the company profile for display on the login page.
 *
 * Data Structure:
 * The data is organized into flat, top-level collections. There is no
 * user-specific nesting, as access control is not based on data ownership.
 *
 * Key Security Decisions:
 * - Authenticated Writes: Any authenticated user can create, update, or
 *   delete a document in any collection.
 * - Authenticated Reads: Any authenticated user can read data from all
 *   collections. The company profile is publicly readable.
 *
 * WARNING: This model is suitable for applications where all authenticated
 * users are considered trusted administrators of the data.
 *
 * Force redeploy: 2024-08-01 12:00:00 UTC
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ----------------------------------------------------------------------
    // Helper Functions
    // ----------------------------------------------------------------------

    /**
     * Checks if the user is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    // ----------------------------------------------------------------------
    // Collection Rules
    // ----------------------------------------------------------------------

    /**
     * @description Allows any authenticated user to read and write.
     * @path /incomes/{incomeId}
     */
    match /incomes/{incomeId} {
      allow read, write: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write.
     * @path /expenses/{expenseId}
     */
    match /expenses/{expenseId} {
      allow read, write: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write.
     * @path /loanSummaries/{loanSummaryId}
     */
    match /loanSummaries/{loanSummaryId} {
      allow read, write: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write.
     * @path /monthlyClosures/{closureId}
     */
    match /monthlyClosures/{closureId} {
        allow read, write: if isSignedIn();
    }
    
    /**
     * @description Allows any user to read the company profile, but only authenticated users to write.
     * @path /companyProfile/{profileId}
     */
    match /companyProfile/{profileId} {
      allow read: if true;
      allow write: if isSignedIn();
    }
  }
}
