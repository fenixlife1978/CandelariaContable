{
  "entities": {
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents an income record from a loan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the income record."
        },
        "date": {
          "type": "string",
          "description": "Date of the income.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the income."
        },
        "description": {
          "type": "string",
          "description": "Description of the income."
        },
        "category": {
          "type": "string",
          "description": "Category of the transaction."
        }
      },
      "required": [
        "id",
        "date",
        "amount",
        "description",
        "category"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense record related to a loan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense record."
        },
        "date": {
          "type": "string",
          "description": "Date of the expense.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        },
        "category": {
          "type": "string",
          "description": "Category of the transaction."
        }
      },
      "required": [
        "id",
        "date",
        "amount",
        "description",
        "category"
      ]
    },
    "LoanSummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoanSummary",
      "type": "object",
      "description": "Represents a monthly loan summary generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the loan summary."
        },
        "month": {
          "type": "string",
          "description": "The month the summary is for.",
          "format": "date-time"
        },
        "summary": {
          "type": "string",
          "description": "The AI-generated summary of the loan's performance for the month."
        },
        "suggestions": {
          "type": "string",
          "description": "AI-driven suggestions to improve cash flow."
        }
      },
      "required": [
        "id",
        "month",
        "summary",
        "suggestions"
      ]
    },
    "MonthlyClosure": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MonthlyClosure",
      "type": "object",
      "description": "Stores the financial summary of a closed month.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the closure record (e.g., '2024-06')."
        },
        "month": {
          "type": "number",
          "description": "The month of the closure (0-11)."
        },
        "year": {
          "type": "number",
          "description": "The year of the closure."
        },
        "initialBalance": {
          "type": "number",
          "description": "The starting capital for the month."
        },
        "totalIncome": {
          "type": "number",
          "description": "Total income for the month."
        },
        "totalExpenses": {
          "type": "number",
          "description": "Total expenses for the month."
        },
        "finalBalance": {
          "type": "number",
          "description": "The closing capital for the month."
        },
        "categoryTotals": {
          "type": "object",
          "description": "A map of totals for each transaction category.",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "income": { "type": "number" },
              "expense": { "type": "number" }
            },
            "required": ["income", "expense"]
          }
        },
        "closedAt": {
          "type": "string",
          "description": "The timestamp when the month was closed.",
          "format": "date-time"
        },
        "status": {
            "type": "string",
            "description": "The status of the monthly closure.",
            "enum": ["open", "closed"]
        }
      },
      "required": [
        "id",
        "month",
        "year",
        "initialBalance",
        "totalIncome",
        "totalExpenses",
        "finalBalance",
        "categoryTotals",
        "closedAt",
        "status"
      ]
    },
    "CompanyProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CompanyProfile",
      "type": "object",
      "description": "Stores the company's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the company profile, should be a singleton."
        },
        "name": {
          "type": "string",
          "description": "The name of the company."
        },
        "rif": {
          "type": "string",
          "description": "The company's tax ID (RIF)."
        },
        "address": {
          "type": "string",
          "description": "The company's address."
        },
        "phone": {
          "type": "string",
          "description": "The company's phone number."
        },
        "email": {
          "type": "string",
          "description": "The company's email address.",
          "format": "email"
        },
        "logo": {
          "type": "string",
          "description": "Data URI of the company's logo."
        }
      }
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income records for all users. Authenticated users have full read/write access.",
          "params": [
            {
              "name": "incomeId",
              "description": "Unique identifier for the income record."
            }
          ]
        }
      },
      {
        "path": "/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense records for all users. Authenticated users have full read/write access.",
          "params": [
            {
              "name": "expenseId",
              "description": "Unique identifier for the expense record."
            }
          ]
        }
      },
      {
        "path": "/loanSummaries/{loanSummaryId}",
        "definition": {
          "entityName": "LoanSummary",
          "schema": {
            "$ref": "#/backend/entities/LoanSummary"
          },
          "description": "Stores monthly loan summaries generated by AI for all users. Authenticated users have full read/write access.",
          "params": [
            {
              "name": "loanSummaryId",
              "description": "Unique identifier for the loan summary."
            }
          ]
        }
      },
      {
        "path": "/monthlyClosures/{closureId}",
        "definition": {
          "entityName": "MonthlyClosure",
          "schema": {
            "$ref": "#/backend/entities/MonthlyClosure"
          },
          "description": "Stores financial summaries for each closed month. Authenticated users have full read/write access.",
          "params": [
            {
              "name": "closureId",
              "description": "Unique identifier for the monthly closure."
            }
          ]
        }
      },
       {
        "path": "/companyProfile/{profileId}",
        "definition": {
          "entityName": "CompanyProfile",
          "schema": {
            "$ref": "#/backend/entities/CompanyProfile"
          },
          "description": "Stores company profile data. A single document should exist. Authenticated users have full read/write access.",
          "params": [
            {
              "name": "profileId",
              "description": "Should be a singleton, e.g., 'main'."
            }
          ]
        }
      }
    ],
    "reasoning": "Given the requirement for authenticated users to have universal read, write, and list permissions across the database, and the need to track income, expenses, and generate loan summaries, the structure will prioritize simplicity and ease of access.  Since there are no restrictions, authorization independence is not a concern, and we don't need to denormalize data for security purposes. The data structure is designed to be flat and easily queryable.\n\nAll data will be stored at the top level, grouped by entity type. This straightforward approach facilitates easy querying and manipulation of data, aligning with the requirement for unrestricted access for authenticated users. This structure also fulfills the QAP requirement as it allows listing of every document without the need for complex security rules or filtering."
  }
}
